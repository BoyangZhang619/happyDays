<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>é€šä¹‰åƒé—® AI èŠå¤© Demo</title>
    <style>
        /* CSS æ ·å¼ï¼šè®©é¡µé¢å¸ƒå±€æ›´å‹å¥½ */
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            max-width: 700px;
            margin: 40px auto;
            padding: 20px;
            background-color: #f4f7f9;
            border-radius: 8px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.1);
        }
        h1 {
            color: #333;
            border-bottom: 2px solid #ccc;
            padding-bottom: 10px;
        }
        #userInput {
            width: 100%;
            height: 120px;
            padding: 15px;
            margin-bottom: 15px;
            border: 1px solid #ddd;
            border-radius: 4px;
            resize: vertical;
            box-sizing: border-box; /* ç¡®ä¿ padding ä¸å½±å“å®½åº¦ */
        }
        #sendButton {
            padding: 10px 20px;
            background-color: #007bff;
            color: white;
            border: none;
            border-radius: 4px;
            cursor: pointer;
            font-size: 16px;
            transition: background-color 0.3s;
        }
        #sendButton:hover:not(:disabled) {
            background-color: #0056b3;
        }
        #sendButton:disabled {
            background-color: #cccccc;
            cursor: not-allowed;
        }
        #modelOutput {
            margin-top: 25px;
            padding: 20px;
            border: 1px solid #e0e0e0;
            border-radius: 4px;
            min-height: 80px;
            background-color: white;
            white-space: pre-wrap; /* ä¿ç•™æ¨¡å‹çš„æ ¼å¼ï¼Œå¦‚æ¢è¡Œ */
            color: #2c3e50;
        }
    </style>
</head>
<body>
    <h1>ğŸ¤– AI è‡ªåŠ¨å›å¤ï¼ˆé€šä¹‰åƒé—®ä»£ç†ï¼‰</h1>
    
    <label for="userInput">è¯·è¾“å…¥æ‚¨çš„é—®é¢˜:</label>
    <textarea id="userInput" placeholder="ä¾‹å¦‚ï¼šå¦‚ä½•ä½¿ç”¨ JavaScript è°ƒç”¨ APIï¼Ÿ"></textarea>
    
    <button id="sendButton" onclick="sendToModel()">å‘é€ç»™æ¨¡å‹</button>
    
    <h2>æ¨¡å‹å›å¤:</h2>
    <div id="modelOutput">åœ¨è¿™é‡Œæ˜¾ç¤ºæ¨¡å‹çš„å›å¤...</div>

    <script>
        // ï¼ï¼ï¼å°†æ­¤æ›¿æ¢ä¸ºæ‚¨å®é™…éƒ¨ç½²çš„ Serverless ä»£ç† URL ï¼ï¼ï¼
        const PROXY_URL = "https://happy-days-rho.vercel.app/api/qwen_proxy";
        
        const userInput = document.getElementById("userInput");
        const outputDiv = document.getElementById("modelOutput");
        const sendButton = document.getElementById("sendButton");

        async function sendToModel() {
            const message = userInput.value.trim();
            
            // 1. è¾“å…¥æ ¡éªŒ
            if (!message) {
                outputDiv.innerText = "è¯·è¾“å…¥å†…å®¹åå†å‘é€ï¼";
                return;
            }

            // 2. çŠ¶æ€æ›´æ–°ï¼ˆç¦ç”¨æŒ‰é’®ï¼Œæ˜¾ç¤ºåŠ è½½ä¸­ï¼‰
            sendButton.disabled = true;
            outputDiv.innerText = "ğŸ“¡ æ­£åœ¨é€šè¿‡ä»£ç†æœåŠ¡å™¨ä¸é€šä¹‰åƒé—®é€šä¿¡ï¼Œè¯·ç¨å€™...";

            try {
                // 3. å‘é€ Fetch è¯·æ±‚åˆ°ä»£ç† URL
                const response = await fetch(PROXY_URL, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json' 
                    },
                    body: JSON.stringify({
                        message: message // å­—æ®µåä¸åç«¯ä»£ç† qwen_proxy.js ä¿æŒä¸€è‡´
                    }),
                });
                
                const data = await response.json();

                // 4. å¤„ç†å“åº”
                if (response.ok) {
                    // ä»£ç†è¿”å›çŠ¶æ€ç  200ï¼Œå¹¶è¿”å›äº† reply å­—æ®µ
                    if (data.reply) {
                        outputDiv.innerText = data.reply; 
                    } else {
                        outputDiv.innerText = "æ¨¡å‹è¿”å›çš„æ•°æ®æ ¼å¼ä¸æ­£ç¡®æˆ–ä¸ºç©ºã€‚";
                    }
                } else {
                    // ä»£ç†è¿”å›é 200 çŠ¶æ€ç  (ä¾‹å¦‚ 400, 500)
                    outputDiv.innerText = `ä»£ç†æœåŠ¡å™¨é”™è¯¯ (${response.status}): ${data.error || 'æœªçŸ¥é”™è¯¯'}`;
                }

            } catch (error) {
                // 5. å¤„ç†ç½‘ç»œæˆ– CORS é”™è¯¯
                console.error("Fetch/ç½‘ç»œé”™è¯¯:", error);
                outputDiv.innerText = "âŒ ç½‘ç»œè¯·æ±‚å¤±è´¥ï¼Œè¯·æ£€æŸ¥æ‚¨çš„ä»£ç† URL æ˜¯å¦æ­£ç¡®ï¼Œæˆ–æŸ¥çœ‹æ§åˆ¶å°äº†è§£ CORS/ç½‘ç»œè¿æ¥é—®é¢˜ã€‚";
            } finally {
                // 6. æ¢å¤æŒ‰é’®çŠ¶æ€
                sendButton.disabled = false;
            }
        }
    </script>
</body>
</html>
